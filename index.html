<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Oh no, non di nuovo un altro tag</title>
  <link rel="stylesheet" href="style.css">
  
</head>
<body>
   <div id="esterno">
    <div id="barContainer">
      <div id="barFill"></div>
    </div>

    <div id="container">
      <div class="stack-container">
        <img src="Background.png" alt="">
        <img src="01Hand.png" alt="">
        <img src="02Hand.png" alt="">
        <img src="03Hand.png" alt="">
        <img src="04Hand.png" alt="">
        <img src="01Half.png" alt="">
        <img src="02Half.png" alt="">
        <img src="03Half.png" alt="">
        <img src="01Heart.png" alt="">
        <img src="02Heart.png" alt="">
        <img src="03Heart.png" alt="">
      </div>
    </div>
  </div>

  <div id="progress"></div>
  <div id="timer"></div>
  <div style="margin-top: 20px;">
    <button id="startBtn">Inizia</button>
    <button id="infoBtn" style="margin-left: 10px;">ℹ️ Info</button>
  </div>
  
  <div id="asciiArt" style="display: none; white-space: pre; font-family: monospace; text-align: center; margin-top: 20px; max-width: 100vw; overflow-x: auto;">
888#88888OOOOOoo:::::oooOOOoO8Oo::::::.::..::oo:o::::o:::oO888OOO8oO888OOo:::::::::::::::::::::::::::.......:.:..........:ooooOOOO8888888888888888888888888O8888
88888888OOOOOooo:::::oooOoooooo:..:::::::..::::::::::::::ooOOOOO8OoO8Ooooo::::::::::::::::::::::::::::.........:.........:oooooOOOOOOOOOOOOOO8888888888888888888
888888888OOOOoo::::::oOOOo::.....:::::::...:...::::::::::::oooooOoooooooooo::::::::o:ooo:::::::::::::::........::.........:oooooOOOOOOOOOOOOOOOOOO88888888888888
8888888888OOOo::.::::oooo:.......::::o::..::..::::::::::::::::ooooooooooooooooooo::oooooo::::::::::::::.........::........:ooooooOOOOOOOOOOOOOOOOOO88OOO88888888
88888888888OO::::::::::::........::::o::..::::::ooooo:::::::::::ooooooooooooooooooooooooooo:::::::::::::.......:.::.......:oOOooOOOOOOOOOOOOOOOOOOO8888OOOOOOOOO
888888888O8Oo::::::::::........::::::o:::::::::oooo::ooo::::::::::oooooooooooooooooooooooooooo::::::::.........:..:.......:oOOOOOOOOOOOOOOOOOOOOOOO8888OOOOOOOOO
888888888OOOo:..:::::::.......::::::oo::.::::::::::::::::::::::::::ooooooooooooooooooooooooo::::::::.......... ...::......:ooooOOOOOOOOOOOOOOOOOOOOO8888OOOOOOOO
88888888OOOo::.::.....::.....:::::::oo::::::::o:::::::::::::::ooooooooooooooooooooooooo::::::::..:............ .:..::.....:ooooOOOOOOOOOOOooOOOOOOOOOOOOOOOOOOOO
8888888OOOo:::::........::::.:::::::oo:::.::::o::::::::o:ooooo:::oooooooooooooooo::::::::...............:........:..::.....ooooOOOOOOOOOOOoooOOOOOOOOOOOOOOOOOOO
8888888OOoo:.:...::......:::::::::::oo:::.::::::::::::::::oooooooooooooooooooooo:::::::.............::::::.......::..::....::oOOOOOOOOOOOOOOoOOOOOOOOOOOOOOOOOOO
888888O8Ooo:.......:.....:::::::::::o:::::::::::o:::::.:::ooooo::::oooooooooooo::::::...... .....:::..............:...:......:oOOOOOOOOOOOOOOOoOOOOOOOOOOOOOOOOO
8888888OOo:.:........:::::::::::::::o:::::::::::ooooooo::oooooooo:::ooooooooooo:::::.............::::.............::..::.....:oOoOOOOOOOOOOOOOOOOOOOOOOooOOOOOOO
888888OOOOo.::.......:::::::::::o:::o:::::::oooooooooo::::::::::::ooooooooooooo::::.....::......:::::............ .:::.::.....:oOOOOOOOOOOOOOOOOOOOOOOooooOOOOOO
888888Oooo:.:::::..::::::::::::::ooooo:::::::::::::oo::::::oo:::::ooooooooooooo:::...:::::::..:::................ .:::..:.....:oOOOOOOOOOOOOOOOOOOOOOOOOOoOOOOOO
8888OOoooo::::::::::::::::::::::::oo:::::::::::oo::ooo::::::::::::::ooooooooooo::..:::::::::..................     .::...:....:oOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOoo
8888OOooo:::::::::::::::::::::::::o::::::::::::oooooooooooo:::::::::::ooooOoooo::......::::::::................   ..:::..::....:ooOOOOOOOOOOOOOOOOOOOOOOOOOOOOoo
8888OOOOoo:::::::oooo::::::::::::o:::::.:.:::ooooooooooooooooooooo:....:::ooo:::......:::::::::::::::................::...:.....:oOOOOOOOOOOOOOOOOOOOOOOOOOOOOOo
O88OOOOoo::::::ooooooo::oo:::::oooo::::...:::oooooooooooooooooooooo:.......:... .....::::::::::::::::........... ..  .::...:.....:OOOOOOOOOOOOOOOOOOOOOOOOOOOOOo
8888OOooo:::oooooooo:::o:::ooooo::::.......:oooooooooooooooooooooooo:.....:........:::::::::::::::::::..:....... ... .::....:.....:ooOOOOOOOOOOOOOOOOOOOOOOOOOOo
88OOOOooooooooo::::::o::::ooo::::.:::.....:::oooooooooooooooooooooooo.....:::......:::::::::::::::::::::............  .::..........:oOOOOOOOOOOOOOOOOOOOOOOOOOOO
O88OOOoooooo::::::::::oooooo:::::..::.....:.:oooooooooooooooooooooooo...:oOooo:....::::::::::::::::::::::............ .:::.........:OOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOooo::::::::oooooooooo:::::...::..:..:.:ooooooOOOOooOoOOOOoooooo..:OOOOOoo....::::::::::::::::::::::....  .....   .::....:....oOOooOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOooo:::::::ooooooo:::::o::::....::.:.:..::oooooOOOOOOOOOOOOOoooo:.:oOOOOOOo:...:::::::::::::::::::::::..  .....    .:::....::..::::ooOOOOOOOOOOOOOOOOOOOOOOO
OOOOOooo::::oooooooo:::::o:o:::::....:::.:::.::ooooOOOOOOOOOOOOOoooo..oOOOOOOOoo...::::::o:o:::::::::::::.... .....   . .::.....::...::ooOOOOOOOOOOOOOOOOOOOOOOO
OOOOOoooooooooooooooo::::oooo::::.....:::::::.:oooooOOOOOOOOOOOOooo:.oOOOOOOOOoo:..:::::oooooo::::::::::.........:.     ..::....:::...::ooOOOOOOOOOOOOOOOOOOOOOO
oOOOOooooooooooooooo::::ooooo::::.....::::::::::oooooOOOOOOOOOOOoo:.:oOOOO8OOOOoo:..:::ooooooo::::::::::........:..    ....::....:::..:oooOOOOOOOOOOOOOOOOOOOOOO
::oOOooooooooOOOOOoooo::ooooo::::......::oo::::::oooooOOOOOOOOOoo:.:oOOOO888OOOooo...::ooooooo:::::::::.......:..       ...:::....:::..:oooOOOOOOOOOOOOOOOOOOOOO
oooOOOOoooooOOOOOOOooo::ooooo::::.........:oooo::ooooooOOOOOOooo:::ooOOOO888OOOooo:..:::ooooo:::::::::......::..        . ..::.....::...::oOOoOOOOOOOOOOOOOOOOOO
OOOOOOOOOooOOOOOOOOooo:oooooo::o:............::ooooooooooooooo::::oooOOOO8888OOOooo:..::ooooo::::::::...::oo:..            ..::....:::...::oooOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOoooo:oooooo:oo:.............::.::::oooooo:oooooooooOOOO8888OOOooo:::..::oooo:::::::::::::..              ...::....:::...:ooooOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOooooooooooo:oo:........:.....:::oooooOOOOOOOOooooooOOOO888OOOOoooo::::::::::::::::......  . .          ......::....:::...:oooOOOOOOOOOOOOOoOOO
OOOOOOOOOOOOOOOOOOooooooooooo:oo:.........:.:..::::ooOOOOOOOOOOooooOOOOOOOOOOOOOOoooo::ooooooo:::::::.      ... .    .   ........:.....:....:::ooooOOOOOOOOOOoOO
OOOOOOOOOOOOOOOOOOoooooooooooooo:........:::....::::ooOOOOOOOOOOOOOOOOOOO888OOOOoooooooooooooooo::::..      ...  .   .. ...............:::....:ooooOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOooooooooooooooo::........::::::::::oooOOOOOOOOOOOoOOOOOO888OOOOOooooooooooooooo:::..    .........  .....................:....:o:ooooOOOOOOOOOoo
OOOOOOOOOOOOOOOOOooooooooooooooo::......:::::::::::::oooOOOOOOOOOOoOOOOOOO8OOOOOOOooooooooooooo::::.......................................:....:::oooooOOOOOOOOO
OOOOOOO88OOOOOOOoooooooooooooooo::...:.:::::::::::o:::ooooooOOOOOooOOOOOOOOOOOOOOooooooooooooo::::................................................ooooooOOOOooOO
8OOOOOO8OOOOOOOOoooooooooooooooo::::::::::::::::::o::::ooooooOOOooooOOOOO88OOOOOooooooooooo::::::...........................................:.....:oooooOOOOOOOO
8OOOOOOOOOOOOOOoooOoOOoooooooooo::::::::::::::::::O:::.:oooooooooooooOOOOOOOOOOooooooooooo:::::.............................:.:.....................:ooooooOOOOO
OOO88OOOOOOOOOOOooOoOoooooooooooo:::::::::::::::::O::::..:ooooooooooooOOOOOOOOoooooooooo::::::..............................:::..::..................:oooooooOOO
OOO88888OOOOOOOoooOOOooooooooooooo::::::::::::::::O:::::..:oooooooooooOOOOOOOOooooooooo::::::.........:....................::::.:::..................:oooooooOOO
OO888OOOOOOOOOoooOOOOoooooooooooooo:oo::::::::::::oo:::::..:oooooooooooOOOOOOOOooooo:::::::.........::::.................:.::::::::::.................:::oooooOO
OO8OOOOOOOOOOOoooOOOOooooooooooooooooo::::::::::::oo:::::::..:ooooooooooooOOOoooo:::::::::......:.::::::................:..::::::::::...................::oooOOo
O88OOOOOOOOOOOOoOOOOooooooooooooooooooo:o:::::::o:oo::o::::...ooooooooooooooooooo:::ooo::.......::::::::::..............:..:::::::::.....................:oooOOo
O88OOOOOOOOOOOOoOOOOooooooooooooooooooooooo:::::oooO:::::::::.:ooooooooooooooooooooooo::.......:::::::::::................:::::::::.....................:::ooooo
8888888OOOOOOOoOOOOOooooooooooooooooooooooo::::::ooOo:::::::::::oooOOOOooooooooooooooo:........:::::::::::...............:..::::::.  .....  ............:.:::ooo
O8OOOOOOOOOOOOOOOOOooooooooooooooooooooooooo::::oooOo::::::::::::ooOOOOOOOOOoOooooooo:.........:::::::::::..............::..:::::..  ...... ..........:...:::::o
OOOO8OOOOOOOOOoOOOOooooooooooOOooooooooooooo::ooooooOoo:::::::::::oooOOOOOOOOOoooooo:.........:::::::::::.:.............:...::::....   ..................::...::
OOOOOOOOOOOOOooOOOOooooooooooOooooOOoooooooo::ooooooOooooo:::::::::ooooOoooooooooo::::........::::::::::..:.............:...:::....    ................:.::.::.:
OOOOOOOOOooOOoOOOooOoooooooooOooooOOooooooooo:oooooooOoooooo::::::::oooooooo::::.::::::......:::::::::::.:::...............:::......   ...................::::..
OOOOOOOOOoooooOOOoOooooooooooOooooOOoOooooooooooooOOO8ooooooo::::::oooooo::... .:::::::::....:::::::::::::.:..........:...:::......... ..........  .....:.:::...
OOOOOOOOooooooOOOoOooooooooooOooooOOoOoooooooooOOOoooO8Oooooooo::::oooooo::::::::o:o::::::..::::::::::::::.::........:....::...........................::..:..::

  </div>
  <div id="asciiMessage" style="display: none; font-family: 'Courier New', monospace; font-size: 18px; color: #ffccff; margin-top: 10px; text-align: center;">
    Ehy tu! <br> Sono la strega malvagia. <br> Vuoi sapere la verità? Non mi apprezzano abbastanza. <br> Voglio andarmene, ma non sono nemmeno abbastanza potente. <br><br> .....Non mi guardare così, con la mia terapeuta abbiamo concordato che riconoscere i nostri limiti è una cosa sana. <br><br> Aiutami tu e in cambio avrai la libertà di questo Mattia che nostro malgrado è finito nella mia rete d'inganni. <br><br> Portami degli incantesi così da farmi diventare abbastanza potente. <br><br> Le parole magiche le trovi dalla mia segretaria nel regno accanto al nostro: <b>Discord.</b> <br><br> In particolare nella regione dei <b>Proci. </b> <br><br> Io e lei portiamo lo stesso nome, non ti puoi sbagliare! <br><br> <i>Non escludo che chiederà qualcosa in cambio...</i> Ma noi teniamo alla libertà di Mattia, giusto? <br><br> Ovviamente continueremo questo teatrino, tu provi a battermi e non ci riesci. Non voglio perdere la faccia davanti a questa plebaglia demonesca. <br><br> Io per ora ho solo una parola magica su 3, prova a inserirla: <b>MAIL.</b> 
  </div>
  <div id="codeBox" style="display: none; margin-top: 20px;">
    <input type="text" id="codeInput" placeholder="Inserisci il codice magico" />
    <button onclick="submitCode()">Applica Codice</button>
    <div id="codeMessage"></div>
  </div>

  <script>
    let hasLostOnce = false;
    const validCodes = {
      "MAIL": 2,
      "LINK": 5,
      "ABBIAMO_FINITO_NON_NE_SEI_IMMENSAMENTE_FELICE?IO_SI": 30
    };

    let timeLimit = 1;
    let timeLeft = timeLimit;
    let timerInterval = null;
    let gameStarted = false;

    const progressDiv = document.getElementById("progress");
    const timerDiv = document.getElementById("timer");
    const startBtn = document.getElementById("startBtn");
    const barFill = document.getElementById("barFill");

    let barValue = 0;
    const increment = 3;
    const decayPerSecond = 8;

    const handImages = ["01Hand.png", "02Hand.png", "03Hand.png", "04Hand.png"];
    
    function submitCode() {
      const codeInput = document.getElementById("codeInput").value.trim().toUpperCase();
      const message = document.getElementById("codeMessage");

      const codeMap = {
        "MAIL": "01",
        "LINK": "02",
        "ABBIAMO_FINITO_NON_NE_SEI_IMMENSAMENTE_FELICE?IO_SI": "03"
      };

      if (codeMap[codeInput]) {
        const codeNumber = codeMap[codeInput];
        timeLimit = validCodes[codeInput];
        message.textContent = `Codice accettato! Nuovo tempo: ${timeLimit} secondi.`;

        const fullHeart = [...document.querySelectorAll(".stack-container img")].find(i => i.src.includes(codeNumber + "Heart"));
        const halfHeart = [...document.querySelectorAll(".stack-container img")].find(i => i.src.includes(codeNumber + "Half"));

        if (fullHeart) fullHeart.style.display = "block";
        if (halfHeart) halfHeart.style.display = "none";
      } else {
        message.textContent = "Codice non valido.";
      }
    }

    function updateHandByTime() {
      const interval = timeLimit / 4;
      const index = Math.floor((timeLimit - timeLeft) / interval);

      document.querySelectorAll('.stack-container img[src*="Hand"]').forEach(img => {
        img.style.display = 'none';
      });

      const handToShow = handImages[index];
      if (handToShow) {
        const img = [...document.querySelectorAll(".stack-container img")].find(i => i.src.includes(handToShow));
        if (img) img.style.display = "block";
      }
    }

    startBtn.addEventListener("click", startGame);

    function startGame() {
      timeLeft = timeLimit;
      gameStarted = true;

      barValue = 0;
      barFill.style.height = "0%";

      progressDiv.textContent = "Riempi la barra al 100%!";
      timerDiv.textContent = "Tempo: " + timeLeft;
      startBtn.disabled = true;

      updateHandByTime();

      if (timerInterval) clearInterval(timerInterval);

      timerInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft < 0) timeLeft = 0;
        timerDiv.textContent = "Tempo: " + timeLeft;

        barValue = Math.max(0, barValue - decayPerSecond);
        barFill.style.height = barValue + "%";

        updateHandByTime();

        if (timeLeft <= 0) {
          endGame();
        }
      }, 1000);
    }

    document.addEventListener("keydown", (e) => {
      if (!gameStarted) return;

      if (e.code === "Space") {
        e.preventDefault();

        barValue = Math.min(100, barValue + increment);
        barFill.style.height = barValue + "%";
        progressDiv.textContent = `Barra: ${Math.round(barValue)}%`;

        if (barValue >= 100) {
          endGame(true);
        }
      }
    });

    function endGame(vittoria = false) { 
  gameStarted = false; 
  clearInterval(timerInterval); 
  startBtn.disabled = false; 

  if (vittoria) { 
    progressDiv.textContent = "LIBERTÀ (ma per chi?). Questa è la parola che riecheggia nell'ormai silenzioso regno delle tenebre, privato delle incessanti notifiche fastidiose. La crudele e assillante strega Agnese è stata finalmente ricacciata in qualcosa di addirittura più oscuro e remoto di questo regno. Molti demoni sono francamente sollevati. Hai salvato l'intrepido Mattia"; 
  } else { 
    progressDiv.textContent = `AH AH AH! Mattia è stato di nuovo taggato! L'incantesimo più potente che hai era carico al ${Math.round(barValue)}%.`; 
    if (!hasLostOnce) {
  document.getElementById("asciiArt").style.display = "block";
  document.getElementById("asciiMessage").style.display = "block";
  document.getElementById("codeBox").style.display = "block";
  hasLostOnce = true;
}

  }

  timerDiv.textContent = ""; 
}
window.addEventListener("load", () => {
  document.getElementById("popupMessage").style.display = "block";
});

function closePopup() {
  document.getElementById("popupMessage").style.display = "none";
}

document.getElementById("infoBtn").addEventListener("click", () => {
  document.getElementById("popupMessage").style.display = "block";
});

document.getElementById("container").addEventListener("click", () => {
  if (!gameStarted) return;

  barValue = Math.min(100, barValue + increment);
  barFill.style.height = barValue + "%";
  progressDiv.textContent = `Barra: ${Math.round(barValue)}%`;

  if (barValue >= 100) {
    endGame(true);
  }
});

  </script>
  <!-- Popup Modal -->
<div id="popupMessage" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
  background-color: #222; padding: 20px; border: 2px solid #555; border-radius: 10px; z-index: 9999; max-width: 90%; text-align: center;">

<p> <b>Oh no, Mattia è stato catturato. </b><br><br> La temibile e assillante strega Agnese gli sta delle piccole luci che compaiono incessamente con fastidiosi rumori intorno a delle icone. <br><br> Una bizzarra forma di tortura che non la fanno essere la più rinomata strega del regno, ma ehy sai cosa? Alla fine è una forma d'arte anche questa. <br><br> A ogni modo, tornando a Mattia: <br><br> SALVALO! <br><br> PRESTO! <br><br> <b> Quando avvii l'incontro carica l'incantesimo più potente che hai premendo il tasto designato! </b> <br><br> (BARRA SPAZIATRICE)</p>
<button onclick="closePopup()">Chiudi</button>
</div>

</body>
</html>
